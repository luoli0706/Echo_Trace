{
  "meta": {
    "version": "1.0.0",
    "description": "Echo Trace WebSocket Protocol Definition",
    "serialization": "JSON",
    "note": "All coordinates are float64. Directions are unit vectors or angle (degrees)."
  },
  "packet_types": {
    "C2S": {
      "LOGIN_REQ": 1001,
      "CREATE_ROOM": 1010,
      "JOIN_ROOM": 1011,
      "LIST_ROOMS": 1013,
      "HEARTBEAT_REQ": 1002,
      "MOVE_REQ": 2001,
      "USE_ITEM_REQ": 2002,
      "INTERACT_REQ": 2003,
      "PICKUP_REQ": 2004,
      "DROP_REQ": 2005,
      "CHOOSE_TACTIC_REQ": 2006,
      "BUY_REQ": 2007,
      "SELL_REQ": 2008,
      "SHOP_REFRESH_REQ": 2009,
      "DEV_SKIP_PHASE_REQ": 9001
    },
    "S2C": {
      "LOGIN_RESP": 1001,
      "ROOM_JOINED": 1012,
      "ROOMS_LIST": 1014,
      "HEARTBEAT_RESP": 1002,
      "GAME_START_PUSH": 3001,
      "GAME_STATE_PUSH": 3002,
      "GAME_OVER_PUSH": 3003,
      "ERROR_PUSH": 4001,
      "MSG_PUSH": 4002
    }
  },
  "models": {
    "Vector2": {
      "x": "float64",
      "y": "float64"
    },
    "Item": {
      "uid": "string (unique instance id)",
      "id": "string (config id, e.g., 'WPN_SHOCK_T1')",
      "type": "string (OFFENSE|SURVIVAL|RECON|SCAVENGE)",
      "tier": "int (1-3)"
    },
    "PlayerState": {
      "session_id": "string",
      "pos": "Vector2",
      "hp": "float64 (0-100)",
      "max_hp": "float64",
      "move_speed": "float64 (current effective speed)",
      "view_radius": "float64",
      "is_alive": "bool",
      "tactic": "string (RECON|DEFENSE|TRAP)"
    },
    "Entity": {
      "uid": "string",
      "type": "string (PLAYER|ITEM_DROP|MOTOR|EXIT|TRAP)",
      "pos": "Vector2",
      "state": "int (e.g., MOTOR_PROGRESS, TRAP_ACTIVE)"
    }
  },
  "packets": {
    "C2S_LOGIN_REQ": {
      "type": 1001,
      "payload": {
        "name": "string"
      }
    },
    "C2S_CREATE_ROOM": {
      "type": 1010,
      "payload": {
        "room_name": "string (required, unique)",
        "config": "object (partial or full GameConfig overlay)"
      }
    },
    "C2S_LIST_ROOMS": {
      "type": 1013,
      "payload": {}
    },
    "S2C_ROOMS_LIST": {
      "type": 1014,
      "payload": {
        "rooms": [
          {
            "room_id": "string",
            "room_name": "string",
            "players": "int",
            "max_players": "int",
            "phase": "int",
            "map_width": "int",
            "map_height": "int"
          }
        ]
      }
    },
    "C2S_JOIN_ROOM": {
      "type": 1011,
      "payload": {
        "room_id": "string (required)"
      }
    },
    "S2C_ROOM_JOINED": {
      "type": 1012,
      "payload": {
        "success": "bool",
        "room_id": "string",
        "room_name": "string",
        "config": "object (GameConfig copy for this room)"
      }
    },
    "S2C_LOGIN_RESP": {
      "type": 1001,
      "payload": {
        "success": "bool",
        "session_id": "string",
        "config": "object (minified game_config copy)"
      }
    },
    "C2S_CHOOSE_TACTIC_REQ": {
      "type": 2006,
      "payload": {
        "tactic": "string (RECON|DEFENSE|TRAP)"
      }
    },
    "S2C_GAME_START_PUSH": {
      "type": 3001,
      "payload": {
        "map_seed": "int64",
        "map_width": "int",
        "map_height": "int",
        "spawn_pos": "Vector2",
        "inventory": "Item[]"
      }
    },
    "C2S_MOVE_REQ": {
      "type": 2001,
      "payload": {
        "dir": "Vector2 (normalized)",
        "look_dir": "Vector2 (normalized, optional; player facing/vision direction)",
        "sprint": "bool (future use)"
      }
    },
    "C2S_USE_ITEM_REQ": {
      "type": 2002,
      "payload": {
        "slot_index": "int"
      }
    },
    "C2S_DROP_REQ": {
      "type": 2005,
      "payload": {
        "slot_index": "int"
      }
    },
    "C2S_BUY_REQ": {
      "type": 2007,
      "payload": {
        "item_id": "string"
      }
    },
    "C2S_SELL_REQ": {
      "type": 2008,
      "payload": {
        "slot_index": "int"
      }
    },
    "C2S_SHOP_REFRESH_REQ": {
      "type": 2009,
      "payload": {}
    },
    "S2C_GAME_STATE_PUSH": {
      "type": 3002,
      "desc": "The main sync packet. Contains everything the player can SEE or HEAR.",
      "payload": {
        "timestamp": "int64",
        "seq": "int",
        "self": {
          "pos": "Vector2",
          "hp": "float64",
          "weight_pct": "float64",
          "inventory": "Item[]",
          "buffs": "string[] (e.g., 'SPEED_UP', 'BLEEDING')"
        },
        "vision": {
          "players": "PlayerState[] (only visible ones)",
          "entities": "Entity[] (items, motors, etc.)"
        },
        "sound": {
          "events": [
            {
              "type": "string (FOOTSTEP|GUNSHOT|SCREAM)",
              "dir": "Vector2 (direction to source)",
              "intensity": "float64 (0.0-1.0)"
            }
          ]
        },
        "global_events": [
          {
            "type": "string (PHASE_CHANGE|MOTOR_FIXED|EXIT_OPEN|PLAYER_KILLED)",
            "msg": "string"
          }
        ]
      }
    }
  }
}
