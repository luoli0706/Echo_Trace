# Echo Trace 开发计划（Alpha 0.8）

> 原则：以当前代码为准，待办只列“尚未实现/需完善”的内容；已完成的能力放在本页顶部，避免重复与过期。

---

## ✅ Alpha 0.8 已完成（关键能力）

- [x] 90° 扇形视野 + 墙体 LOS（服务端 AOI 过滤 + 客户端 Fog）
- [x] 鼠标面向控制 + 灵敏度设置
- [x] 道具体系按 Items.md 对齐（类别/阶段权重/战术倾向影响）
- [x] “被动道具”统一为“使用后持续”的服务端 Buff（到期回退）
- [x] 商人系统：每阶段每玩家 1 次免费刷新，后续付费；位置随阶段切换；1-6 买 / Ctrl+1-6 卖 / R 刷新
- [x] 房间系统：房间名唯一、房间列表（阶段/人数/地图尺寸）、按 room_id 加入、每房间独立 GameConfig 副本
- [x] 创建房间：完整 game_config.json 表格编辑器（滚轮/逐项编辑）+ 前后端 clamp 一致回填
- [x] 断线重连 + 超时踢出：宽限期内同 session_id 恢复；超时清理该房间进度并减少人数
- [x] 协议文档：protocol.json 已补齐 1010/1011/1013/1014 与 2007/2008/2009 等
- [x] 文档同步：blueprint / GameFlow / README 已对齐房间、配置、续局规则与键位范围

---

## 🔥 P0（Alpha 0.8 体验与一致性：必须做）

- [ ] **商店价格显示（端到端一致）**
    - 现状：UI 仅显示道具名/缩写，不显示价格
    - 目标：商店列表每条显示价格，且与服务端购买扣费一致（使用 item.Value / fallback 规则）
    - 验收：同一商品在 UI 上显示的价格 = 实际扣费；资金不足时 UI/广播能提示失败原因

- [ ] **对局内玩家名字显示**
    - 目标：在“可见玩家实体”附近或 HUD 列表显示玩家名（只显示扇形内且无遮挡的玩家即可）
    - 验收：多人同房间可区分目标；名字不会穿墙泄露（遵循服务端 AOI）

- [ ] **死亡播报（基于现有全图事件广播）**
    - 目标：当玩家死亡/被淘汰时，全图广播 “X 死亡”
    - 验收：信息来源服务端权威；包含玩家名；不会重复刷屏

- [ ] **道具类型颜色区分（表现种类差别）**
    - 目标：背包/掉落提示/商店列表里按 Item.type（OFFENSE/SURVIVAL/RECON/SCAVENGE）用不同颜色渲染文本
    - 验收：同屏能直观看出类别；不引入新的主题色体系（沿用现有 UI 颜色/少量固定映射）

- [ ] **阶段计时策略对齐（Phase2 计时 vs 事件触发）**
    - 现状：PhaseTimer 会倒计时推进阶段，但 Phase2 也可能因“修够电机”提前进入 Phase3
    - 目标：明确“以计时为准 / 以电机为准 / 二者取先到者”为最终规则，并让文档与配置字段描述一致
    - 验收：规则写入 GameFlow + blueprint；配置字段不再造成误解

- [ ] **配置字段“已接入/未接入”清点**
    - 目标：逐项核对 game_config.json：未接入字段要么实现，要么在 comment 中标注“尚未接入（仅保留占位）”并在文档里避免承诺
    - 验收：配置、实现、文档三者一致；新同学不会被配置误导

---

## 🧩 P1（玩法增强 / 性能优化：可并行推进）

- [ ] **四叉树（Quadtree）空间索引优化**
    - 用途：AOI/可见性/碰撞候选查询（大地图与高实体数场景）
    - 验收：在地图尺寸 256×256、实体数上升时，tick 耗时有可观下降（至少减少线性扫描热点）

- [ ] **复杂侦察道具真实机制**（替换“加视距”的简化实现）
    - 心跳/无人机/全图扫描：输出标记/红点体系（需明确是否穿墙、是否受扇形限制）
    - 透视：轮廓/短暂穿墙信息（需明确反作弊边界与代价）

- [ ] **噪音系统扩展**：更多声音类型/强度曲线/与负重或冲刺联动
- [ ] **经济平衡**：拾取奖励、商人定价、刷新成本与道具强度闭环

---

## 🧪 P2（工程质量 / 社交系统：放到基础体验稳定后）

- [ ] **房间评论区系统**：房间内/房间详情留言与历史（最小可用版即可）
- [ ] **局内实时弹幕系统**：对局中实时滚动消息（要有频率限制/屏蔽策略/性能预算）

- [ ] 端到端冒烟脚本（启动服务端 + 启动客户端 + 关键操作自测）
- [ ] 关键逻辑单元测试：道具效果、商人刷新规则、AOI 可见性边界
- [ ] 日志与调试开关分层（减少默认噪音）

